{% comment %} CSS & JS Imports with Conditions Optimized {% endcomment %}
{{ 'template-collection.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}

{% case section.settings.image_shape %}
  {% when 'blob' %}
    {{ 'mask-blobs.css' | asset_url | stylesheet_tag }}
  {% when 'arch' %}
    {{ 'mask-arch.svg' | inline_asset_content }}
{% endcase %}

{% unless section.settings.quick_add == 'none' %}
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}
  {% if section.settings.quick_add == 'standard' %}
    {{ 'quick-add.js' | asset_url | script_tag }}
    {{ 'product-form.js' | asset_url | script_tag }}
  {% elsif section.settings.quick_add == 'bulk' %}
    {{ 'quick-add-bulk.js' | asset_url | script_tag }}
    {{ 'quantity-popover.js' | asset_url | script_tag }}
    {{ 'price-per-item.js' | asset_url | script_tag }}
    {{ 'quick-order-list.js' | asset_url | script_tag }}
  {% endif %}
{% endunless %}

{% style %}
.section-{{ section.id }}-padding {
  padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
  padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
}

@media screen and (min-width: 750px) {
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
}

.collection-layout {
  display: flex;
  flex-direction: row;
  gap: 2rem;
}

.collection-sidebar {
  flex: 0 0 250px;
}

.collection-main {
  flex: 1;
}
{% endstyle %}

<div class="section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}">
  {%- paginate collection.products by section.settings.products_per_page -%}
    <div class="collection-layout page-width">
      <aside class="collection-sidebar">
        {% if section.settings.enable_filtering or section.settings.enable_sorting %}
          {% render 'facets',
            results: collection,
            enable_filtering: section.settings.enable_filtering,
            enable_sorting: section.settings.enable_sorting,
            filter_type: section.settings.filter_type,
            paginate: paginate
          %}
        {% endif %}
      </aside>

      <div class="collection-main">
        {% if section.settings.enable_sorting %}
          <form class="facets-vertical-form" id="FacetSortForm">
            <div class="facet-filters sorting caption">
              <div class="facet-filters__field">
                <label for="SortBy">{{ 'products.facets.sort_by_label' | t }}</label>
                <div class="select">
                  {%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
                  <select
                    name="sort_by"
                    class="facet-filters__sort select__select caption-large"
                    id="SortBy"
                    aria-describedby="a11y-refresh-page-message"
                  >
                    {%- for option in collection.sort_options -%}
                      <option value="{{ option.value | escape }}" {% if option.value == sort_by %}selected{% endif %}>
                        {{ option.name | escape }}
                      </option>
                    {%- endfor -%}
                  </select>
                  <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
                </div>
              </div>
            </div>
          </form>
        {% endif %}

        <div class="product-grid-container" id="ProductGridContainer">
          {%- if collection.products.size == 0 -%}
            <div class="collection collection--empty" id="product-grid" data-id="{{ section.id }}">
              <div class="loading-overlay gradient"></div>
              <div class="title-wrapper center">
                <h2 class="title title--primary">
                  {{ 'sections.collection_template.empty' | t }}<br>
                  {{ 'sections.collection_template.use_fewer_filters_html' | t: link: collection.url, class: 'underlined-link link' }}
                </h2>
              </div>
            </div>
          {%- else -%}
            <div class="collection">
              <div class="loading-overlay gradient"></div>
              <ul
                id="product-grid"
                data-id="{{ section.id }}"
                class="grid product-grid grid--{{ section.settings.columns_mobile }}-col-tablet-down grid--{{ section.settings.columns_desktop }}-col-desktop {% if section.settings.quick_add == 'bulk' %} collection-quick-add-bulk{% endif %}"
              >
                {% assign skip_card_product_styles = false %}
                {%- for product in collection.products -%}
                  {% if forloop.index > 2 %}{% assign lazy_load = true %}{% else %}{% assign lazy_load = false %}{% endif %}
                  <li class="grid__item{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}" {% if settings.animations_reveal_on_scroll %}data-cascade style="--animation-order: {{ forloop.index }};"{% endif %}>
                    {% render 'card-product',
                      card_product: product,
                      media_aspect_ratio: section.settings.image_ratio,
                      image_shape: section.settings.image_shape,
                      show_secondary_image: section.settings.show_secondary_image,
                      show_vendor: section.settings.show_vendor,
                      show_rating: section.settings.show_rating,
                      lazy_load: lazy_load,
                      skip_styles: skip_card_product_styles,
                      quick_add: section.settings.quick_add,
                      section_id: section.id
                    %}
                  </li>
                  {% assign skip_card_product_styles = true %}
                {%- endfor -%}
              </ul>
              {%- if paginate.pages > 1 -%}
                {% render 'pagination', paginate: paginate, anchor: '' %}
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  {%- endpaginate -%}
</div>
